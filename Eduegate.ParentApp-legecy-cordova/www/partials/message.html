<div class="app-page flex-column flex-column-fluid">
    <div class="app-content flex-column-fluid">
        <!-- <ng-include src="'partials/Templates/header.html'" class=""></ng-include>

        <div class="app-toolbar  w-100 ">
        </div> -->

        <!-- <div class="app-container container-xxl pt-5  mt-n5 rounded-3 bg-light"> -->
        <div class="d-flex" style="
        flex-grow: 1;
    ">
            <div class="vh-100 card shadow-none w-100 border-0 rounded-0" id="kt_drawer_chat_messenger"
                style="background-image: url( clients/{{$root.ClientSettings.Client}}/images/bg-chat.png);">
                <div class="card-header pe-5 bg-chat-header  sticky-top rounded-0 border-0 ios-pt-12 min-h-auto "
                    id="kt_drawer_chat_messenger_header">
                    <div class="card-title">
                        <div class="d-flex">
                            <a ng-click="$root.goBack()" class=" p-5 ms-n5">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19"
                                    fill="none">
                                    <path
                                        d="M20 8.43018H3.95204L10.6306 1.51201L9.17094 0L0 9.5L9.17094 19L10.6306 17.488L3.95204 10.5698H20V8.43018Z"
                                        fill="white" />
                                </svg>
                            </a>
                            <div class="symbol symbol-circle symbol-50px  me-4">
                                <img ng-src="./clients/{{$root.ClientSettings.Client}}/images/profile_img.png" alt=""
                                    class="mw-100">
                            </div>
                            <div class="d-flex justify-content-center flex-column me-3">
                                    <span class="fs-7 fw-semibold text-muted">Parent App</span>

                                <a
                                    class="fs-4 fw-normal text-white text-hover-primary me-1 mb-2 lh-1">{{employeeName}}</a>
                                <div class="mb-0 lh-1">
                                    <!-- <span class="badge badge-success badge-circle w-10px h-10px me-1"></span> -->
                                    <span class="fs-7 fw-semibold text-muted">{{studentName}}</span>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="card-toolbar">
                    </div>
                </div>
                <div class="card-body scroll-y pe-5" id="kt_drawer_chat_messenger_body">

                    <!-- Loop through chat messages -->
                    <div ng-repeat="(i, message) in ChatMessages track by message.CommentIID">

                        <!-- Date separator -->
                        <div ng-if="i === 0 || ChatMessages[i - 1].DisplayDate !== message.DisplayDate"
                            class="text-center my-3">
                            <span class="badge bg-light text-dark px-3 py-2 rounded-pill">
                                {{ message.DisplayDate }}
                            </span>
                        </div>
                        <!-- Left side messages -->
                        <div ng-if="message.CreatedBy != LoginUserID" class="d-flex justify-content-start mb-4 mx-4">
                            <div class="d-flex flex-column align-items-start position-relative">
                                <div class="p-2 rounded-1  text-gray-900 fw-semibold mw-lg-400px mw-300px text-start px-4 chat-box position-relative pb-6 min-w-70px"
                                    style="background-color: #ffffff;">
                                    <div class="p-2 rounded-1 fw-semibold mw-lg-400px mw-300px text-start"
                                        ng-if="message.ParentCommentID" style="background-color: #dcdcdc;">
                                        <small>You : "{{ message.ParentComment }}"</small>
                                    </div>
                                    <span ng-bind-html='message.CommentText | newlineToBr '></span><br>
                                    <span
                                        class="text-end text-gray-500 fs-9 position-absolute end-0 bottom-0 mb-1 me-2">
                                    <span  ng-if="message.BroadcastID" title="Broadcast message">
                                    <svg viewBox="0 0 212 212" height="20" width="20" preserveAspectRatio="xMidYMid meet" class="x1o6zcso" fill="currentColor"><title>announcement-speaker</title><path fill-rule="evenodd" clip-rule="evenodd" d="M89.5827 83.703C89.5827 82.9635 89.9699 82.278 90.6032 81.8962L119.16 64.6781C122.059 62.8863 125.902 64.8549 125.902 68.1319V137.101C125.902 140.308 122.206 142.288 119.301 140.639L90.6507 124.368C89.9905 123.993 89.5827 123.293 89.5827 122.534V83.703ZM46 96.2616C46 88.6676 52.5042 82.5114 60.5276 82.5114H80.209C81.3743 82.5114 82.3189 83.4561 82.3189 84.6213V121.652C82.3189 122.817 81.3743 123.762 80.209 123.762H75.6957L82.4837 147.779C83.0001 149.606 81.9267 151.465 80.0861 151.931L72.2787 153.908C70.4381 154.374 68.5274 153.271 68.0111 151.443L60.2202 123.878C60.2089 123.838 60.1983 123.798 60.1886 123.758C52.3218 123.588 46 117.498 46 110.012V96.2616ZM161.187 71.6946C160.374 70.6624 158.814 70.5245 157.751 71.3468L154.102 74.1721C153.034 74.9983 152.876 76.4799 153.682 77.5251C159.328 84.8487 162.362 93.7105 162.303 102.817C162.244 111.919 159.096 120.741 153.361 127.996C152.536 129.039 152.66 130.516 153.704 131.345L157.352 134.241C158.396 135.07 159.964 134.936 160.799 133.901C167.981 125.002 171.926 114.114 171.999 102.874C172.072 91.624 168.263 80.6813 161.187 71.6946ZM145.914 81.0162C145.113 79.9754 143.55 79.8499 142.494 80.6798L138.867 83.5311C137.806 84.3649 137.664 85.8456 138.444 86.9079C141.82 91.5035 143.641 96.9856 143.626 102.62C143.612 108.251 141.767 113.72 138.373 118.298C137.582 119.364 137.702 120.84 138.746 121.669L142.394 124.564C143.438 125.393 145.009 125.261 145.823 124.211C150.664 117.973 153.303 110.423 153.323 102.642C153.342 94.8522 150.735 87.2808 145.914 81.0162Z"></path></svg>
                                         </span>
                                        {{ message.CreatedDate| date:'hh:mm a' }}
                                    </span>
                                </div>
                                <div class="d-flex align-items-center border border-dashed border-gray-300 rounded min-w-300px p-7"
                                    ng-if="message.PhotoContentID">

                                    <img class="rounded w-250px" ng-if="message.PhotoContentID"
                                        ng-src="{{ContentService}}/ReadImageContentsByID?contentID={{message.PhotoContentID}}"
                                        alt="image" />

                                </div>
                                <div class="text-muted mt-1"
                                    ng-click="selectParentComment(message.CommentIID ,message.CommentText  )">
                                    <small>Reply</small> <!-- Display "Read" status -->
                                </div>
                            </div>
                        </div>
                        <!-- Right side messages -->
                        <div ng-if="message.CreatedBy == LoginUserID" class="d-flex justify-content-end mb-4 mx-4">
                            <div class="d-flex flex-column align-items-end position-relative">

                                <div class="p-2 px-4 pb-5 rounded-1  text-gray-100 fw-semibold mw-lg-400px mw-300px text-end chat-box-right  min-w-50px position-relative"
                                    style="background-color: #8B71A4;">
                                    <div class="p-2 rounded-1 fw-semibold mw-lg-400px mw-300px text-start"
                                        ng-if="message.ParentCommentID" style="background-color: #d7d0ea2e;">
                                        <small> "{{ message.ParentComment }}"</small>
                                        <!-- Parent comment text -->
                                    </div>
                                    <span ng-bind-html='message.CommentText | newlineToBr '></span>
                                    <!-- Display message text -->
                                    <br>
                                    <span class="text-end text-white fs-9 position-absolute end-0 bottom-0 mb-1 me-2">
                                        {{ message.CreatedDate| date:'hh:mm a' }}
                                    </span>
                                </div>

                                <!-- Show read status -->
                                <div class="text-muted mt-1" ng-if="message.IsRead">
                                    <div class="Tick"></div>
                                    <div class="Tick ms-n4"></div>

                                    <small>Read</small> <!-- Display "Read" status -->
                                </div>
                                <div class="d-flex align-items-center border border-dashed border-gray-300 rounded p-2"
                                    ng-if="message.PhotoContentID">
                                    <img class="rounded w-250px" ng-if="message.PhotoContentID"
                                        ng-src="{{ContentService}}/ReadImageContentsByID?contentID={{message.PhotoContentID}}"
                                        alt="image" />

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="w-100 d-flex flex-center  overlay overlay-block" ng-if="!isMessageSendingEnabled">
                        <div class="badge badge-light-danger fs-6 p-3">The teacher is not available for chat at this
                            time. <br> Please try again later</div>

                    </div>
                </div>

                <div class="card-footer pt-4  z-index-3 border-0" id="kt_drawer_chat_messenger_footer">
                    <!--begin::Input-->
                    <div class=" d-flex flex-column mx-3" ng-if="selectedCommentParentId">
                        <div class="">
                            Reply to {{employeeName}}

                        </div>
                        <div class="fs-5  text-truncate">
                            {{ParentcommentText}}

                        </div>
                    </div>
                    <div class=" d-flex flex-column overlay overlay-block">
                        <img ng-if="imagePreviewSrc"
                            alt="Image Preview"
                            ng-src="{{imagePreviewSrc}}"
                            class="rounded w-150px overlay-wrapper">
                        <div class="overlay-layer card-rounded bg-dark w-150px bg-opacity-5" ng-if="isUploading">
                            <div class="spinner-border text-primary" role="status">
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-end mx-3">

                        <div class="d-flex align-items-end me-2 w-100 position-relative">
                            <div class=" fs-2 text-gray-500  ms-2 ">
                                <div class="dropdown">
                                    <button class="btn btn-icon btn-lg rounded-4 me-3 bg-white" data-bs-toggle="dropdown"
                                        aria-expanded="false">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" clip-rule="evenodd"
                                                d="M9 7C9 4.23858 11.2386 2 14 2C16.7614 2 19 4.23858 19 7V15C19 18.866 15.866 22 12 22C8.13401 22 5 18.866 5 15V9C5 8.44772 5.44772 8 6 8C6.55228 8 7 8.44772 7 9V15C7 17.7614 9.23858 20 12 20C14.7614 20 17 17.7614 17 15V7C17 5.34315 15.6569 4 14 4C12.3431 4 11 5.34315 11 7V15C11 15.5523 11.4477 16 12 16C12.5523 16 13 15.5523 13 15V9C13 8.44772 13.4477 8 14 8C14.5523 8 15 8.44772 15 9V15C15 16.6569 13.6569 18 12 18C10.3431 18 9 16.6569 9 15V7Z"
                                                fill="currentColor"></path>
                                        </svg>
                                    </button>

                                    <ul
                                        class="dropdown-menu menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-200px">
                                        <div class="my-4">
                                            <div class="menu-item px-4">
                                                <div class="d-flex flex-stack py-4">
                                                    <div class="d-flex align-items-center">
                                                        <div class="symbol  symbol-25px symbol-md-30px me-4">
                                                            <img class="rounded-0" src="./images/images.svg" />
                                                        </div>
                                                        <div class="mb-0 me-2">
                                                            <a id="UploadPicture"
                                                                class="fs-4 text-gray-800 text-hover-primary fw-semibold">Photos
                                                                & videos</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="menu-item px-4">
                                                <div class="d-flex flex-stack py-4">
                                                    <div class="d-flex align-items-center">
                                                        <div class="symbol symbol-25px symbol-md-30px me-4">
                                                            <img class="rounded-0" src="./images/camera-fill.svg" />
                                                        </div>
                                                        <div class="mb-0 me-2">
                                                            <a id="cameraTakePicture"
                                                                class="fs-4 text-gray-800 text-hover-primary fw-semibold">Camera</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </ul>
                                </div>

                            </div>
                            <textarea
                                class="form-control form-control-solid form-control-lg mh-150px min-h-50px rounded-4 ps-4 pe-5 py-3 bg-white"
                                rows="1" placeholder="Type a message" ng-model="ChatMessage"
                                style="resize: none; overflow-y: scroll;  line-height:2.0; transition: height 0.2s ease-in-out;"></textarea>
                        </div>
                        <button class="btn btn-icon btn-primary rounded-4 symbol symbol-50px symbol-circle"
                            type="button" ng-click="SaveComment(ChatMessage)" data-kt-element="send"
                            ng-disabled="!isMessageSendingEnabled  || isUploading">
                            <span class="h-50 align-self-center send-button"></span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- </div> -->
        </div>
    </div>
</div>

<style>
    .app-wrapper,
    .app-root {
        margin-top: 0 !important;
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        margin-bottom: 0 !important;
    }
</style>